import numpy as np
import matplotlib.pyplot as plt

#d = {'water': [(0.8873134493642003, 1.2540822306141264), (0.12680818485758294, 2.784158016161086), (1.2556914291375354, 2.3942925156490116), (2.799334205169208, 2.793371710128687)], 'pastures': [], 'seed': [(0.4938548570852421, 2.404726109190621), (0.9034012490610992, 3.1646465144201708), (1.6555758637451992, 0.5821088577126128)], 'potato': [], 'soil': [(2.403254638234139, 0.5035148888594937)], 'water_land': [], 'seed_land': [[1.6343488134744035, 2.0689548225126213, 7]], 'pastures_land': []}
array = np.array
d = {'water': [array([[1.06694328, 1.39401992],
       [1.05585806, 1.38263373],
       [1.06935776, 1.31798355],
       [1.0947916 , 1.27162917],
       [1.09830432, 1.20723449],
       [1.10789473, 1.17349049],
       [0.95370103, 1.21672807],
       [0.95223464, 1.26250197],
       [0.91305793, 1.30969205],
       [0.89898159, 1.37356027],
       [0.93685759, 1.444123  ],
       [0.84549353, 1.3754737 ],
       [0.84114034, 1.33886566],
       [0.83035309, 1.32000268],
       [0.82639798, 1.29071228],
       [0.79885188, 1.23142063]]), array([[0.23574637, 2.93324541],
       [0.18838513, 2.89346662],
       [0.1649389 , 2.88233616],
       [0.18383329, 2.87700278],
       [0.15356079, 2.88233994],
       [0.10359082, 2.88967888],
       [0.05079414, 2.88329145],
       [0.03666526, 2.87690899],
       [0.0503064 , 2.92424332]]), array([[1.42947452, 2.41340578],
       [1.36066437, 2.41379868],
       [1.35993588, 2.40109213],
       [1.37467838, 2.44620437],
       [1.40624619, 2.48625312],
       [1.42542437, 2.5476005 ],
       [1.30073735, 2.56545321],
       [1.27036377, 2.53069707],
       [1.2368091 , 2.49790716],
       [1.23801142, 2.44689563],
       [1.24496467, 2.44017835],
       [1.25051603, 2.42037587],
       [1.21638739, 2.43396716],
       [1.18940108, 2.46064911],
       [1.17271678, 2.44885812]]), array([[2.84817507, 2.96683388],
       [2.79569531, 2.90964864],
       [2.74344502, 2.87172258],
       [2.76266652, 2.85731663]])], 'pastures': [], 'seed': [array([[0.68541144, 2.51647609],
       [0.65758159, 2.45142141],
       [0.61744834, 2.42702893],
       [0.5981143 , 2.42449557],
       [0.60058355, 2.42058165],
       [0.57095533, 2.43062174],
       [0.53480665, 2.43570308],
       [0.49157484, 2.43157323],
       [0.47347578, 2.42147171],
       [0.49911802, 2.46328996],
       [0.53883972, 2.50511263],
       [0.55129425, 2.56441651]]), array([[1.04786344, 3.30300232],
       [1.07222711, 3.30928359],
       [1.04371293, 3.31293459],
       [0.98710429, 3.31261472],
       [0.96180984, 3.335829  ],
       [0.95110383, 3.31717108],
       [0.83572278, 3.32518747]]), array([[1.76636845, 0.45948431],
       [1.79438294, 0.51984369],
       [1.81954298, 0.54567822],
       [1.74766236, 0.62345205],
       [1.68323253, 0.60458668],
       [1.6959895 , 0.61487446],
       [1.69630755, 0.55862552],
       [1.70699812, 0.51059956],
       [1.6936191 , 0.47747593],
       [1.68977694, 0.43628277],
       [1.57594411, 0.53150429],
       [1.58939339, 0.58229907],
       [1.60712663, 0.61966992],
       [1.63354447, 0.65192869],
       [1.66404958, 0.68952027],
       [1.66082546, 0.69655218],
       [1.61515143, 0.71900643],
       [1.59184399, 0.73789971]])], 'potato': [], 'soil': [array([[2.45172824, 0.50500087],
       [2.46061367, 0.55102708],
       [2.50515575, 0.57959166],
       [2.51533813, 0.6260016 ],
       [2.53298166, 0.66478864],
       [2.54318607, 0.6629448 ],
       [2.50173987, 0.68670131],
       [2.48185425, 0.7011184 ],
       [2.45814284, 0.66941825],
       [2.44562277, 0.65261761],
       [2.42594919, 0.60555578],
       [2.38962811, 0.56559732],
       [2.36951236, 0.54748193],
       [2.35857307, 0.47480019]])], 'water_land': [], 'seed_land': [array([[0.7144026 , 1.54393639],
       [0.66188153, 1.46103676],
       [0.68341769, 1.35247437],
       [0.68995128, 1.27232569],
       [0.72074169, 1.16432248],
       [0.74571752, 1.0843424 ],
       [0.47242963, 1.22147712],
       [0.42927911, 1.29926987],
       [0.42055425, 1.40098456],
       [0.44653954, 1.52873344]])], 'pastures_land': []}

d = {'water': [(0.7565348394092002, 1.3310566082528834), (-0.04717415053549723, 2.9295333488000104), (1.0411178765316427, 2.466610847183123), (2.7374931587812843, 2.9609185904663526)], 'pastures': [], 'seed': [(0.42138223490104676, 2.5259378532688324), (0.74566940480658, 3.3557579099840833), (1.6230203712866171, 0.7362389519206491)], 'potato': [], 'soil': [(2.3162758191378297, 0.5814677287694261)], 'water_land': [[3.7751945689955013, 0.15242706997758507, 1]], 'seed_land': [[0.46331760698986324, 1.370059756731815, 7]], 'pastures_land': []}





field = {
    'seed': [(1.662, 0.528), (0.906, 3.174), (0.528, 2.418)],
    'seed_land': [(0.15, 3.552)],
    'water': [(0.15, 2.796), (1.284, 2.418), (0.906, 1.284), (2.796, 2.796)],
    'water_land': [(3.552, 0.15)],
    'pastures': [(1.284, 1.284)],
    'pastures_land': [(3.552, 3.552)],
    'potato': [(2.418, 0.528)],
    'soil': [(2.418, 2.04)]
}

TH = 1
mapping = {
    'water': 'b',
    'pastures': 'g',
    'seed': 'y',
    'potato': 'r',
    'soil': 'm',
    'water_land': 'b',
    'seed_land': 'y',
    'pastures_land': 'g'
}

MODE = 0

deltas = []

def distance(p1, p2):
    return ((p1[0] - p2[0])**2 + (p1[1] - p2[1])**2)**0.5

for key in d:
    for i in range(len(d[key])):
        if len(d[key][i]) == 0: continue
        if MODE:
            temp = np.array(d[key][i])
            if len(temp.shape) == 1:
                d[key][i] = np.delete(d[key][i], 2)
                temp = np.array(d[key][i])
                m = np.array(temp)
            else:
                m = temp.mean(axis=0)
            # plt.plot(m[0], m[1], marker='o', color=mapping[key])
            min_ = 99999999999999
            for point in field[key]:
                dist = distance(m, (point[0], point[1]))
                if dist < min_  and dist < TH:
                    min_ = dist
            if min_ != 99999999999999:
                deltas.append(min_)
        else:
            # plt.plot(d[key][i][0], d[key][i][1], marker='o', color=mapping[key])
            min_ = 99999999999999
            for point in field[key]:
                dist = distance(d[key][i], (point[0], point[1]))
                if dist < min_ and dist < TH:
                    min_ = dist
            if min_ != 99999999999999:
                deltas.append(min_)

print(sum(deltas)/len(deltas), max(deltas), min(deltas))   
# plt.show()

"""
v2

```
0.07686062370905722 0.10916006745033924 0.012342513111696693
0.07781750236469706 0.10072428023463263 0.05997146669511607
0.03687654894040232 0.04537730178936658 0.022929306053807448
0.06352113544216431 0.09374620532334271 0.04076798926446839
0.054241924517488174 0.07373880934074359 0.0277227538345282
```

"""